class Reviews{constructor(e,t="#revblock"){this.source=e,this.container=t,this.revItems=[],this._init(),this._addReview(),this._approve(),this._deletRev()}async _init(){await fetch(this.source).then(e=>e.json()).then(e=>{for(let t of e)this.revItems.push(t),this._renderReview(t);console.log(this.revItems)})}_renderReview(e){new Review(e.id,e.author,e.text,e.isApproved)}static async newRew(){let e=new Reviews(source);return await e._init(),e}_addReview(){$("#leaverev").on("submit",e=>{e.preventDefault();let t=$('#leaverev [name="name"]').val(),i=$('#leaverev [name="text"]').val();if(null!==t.match(/^[a-zа-яё \-]{2,}$/gi)&&""!==i){let e=[];for(let t of this.revItems)e.push(t.id);Array.prototype.max=function(){return Math.max.apply(null,this)};let s=e.max()+1;new Review(s,t,i,!1);this.revItems.push({id:s,author:t,text:i,isApproved:!1}),console.log(this.revItems),$('#leaverev [name="name"]').val(""),$('#leaverev [name="text"]').val("")}})}_approve(){$("#revblock").on("click",'[data-approve="false"]',e=>{let t=+$(e.target).parents(".revitem").data("id");for(let e of this.revItems)e.id===t&&(e.isApproved=!0);$(e.currentTarget).attr("data-approve","true"),console.log(this.revItems)})}_deletRev(){$("#revblock").on("click","[data-delete]",e=>{let t=+$(e.target).parents(".revitem").data("id");for(let e of this.revItems)e.id===t&&(this.revItems=this.revItems.filter(e=>e.id!==t),$(`.revitem[data-id="${e.id}"]`).remove());console.log(this.revItems)})}}class Review{constructor(e,t,i,s=!1,a="#revblock"){this.id=e,this.author=t,this.text=i,this.isApproved=s,this.container=a,this._render()}_render(){let e=$("<div/>",{class:"revitem","data-id":this.id}),t=$(`<span class="revid">Отзыв №${this.id}</span>`),i=$("<strong/>",{class:"author",text:this.author}),s=$(`<div class="text"><p>${this.text}</p></div>`),a=$(`<div data-approve="${this.isApproved}"><svg><use xlink:href="#check"></svg></div>`),r=$('<div data-delete><svg><use xlink:href="#trash"></svg></div>');t.appendTo(e),i.appendTo(e),s.appendTo(e),a.appendTo(e),r.appendTo(e),$(this.container).append(e)}}